; https://docs.nextcloud.com/server/22/admin_manual/installation/server_tuning.html?highlight=tuning
; Performance optimizations for PHP 8.4

[PHP]
; recommended value of 512MB for php memory limit (avoid warning when running occ)
memory_limit=512M
post_max_size=513M
upload_max_filesize=513M
; Performance: Increase max execution time for large operations
max_execution_time=3600
max_input_time=3600
; Performance: Optimize realpath cache for reduced filesystem calls
realpath_cache_size=4096K
realpath_cache_ttl=600

[opcache]
; Modify opcache settings in php.ini according to Nextcloud documentation (remove comment and set recommended value)
opcache.enable=1
opcache.enable_cli=1
; Performance: Increased from 512MB to 1GB for larger codebases
opcache.memory_consumption=1024
; Performance: Increased from 64MB to 128MB for more interned strings
opcache.interned_strings_buffer=128
; Performance: Increased from 10000 to 100000 for larger projects
opcache.max_accelerated_files=100000
; Performance: Validate scripts every 60 seconds (production setting)
opcache.revalidate_freq=60
opcache.save_comments=1
; Performance: Optimize PHP 8.4 JIT for tracing mode (1255 = tracing JIT with all optimizations)
opcache.jit=1255
; Performance: Increased JIT buffer from 128MB to 256MB for better performance
opcache.jit_buffer_size=256M
; Performance: Enable file cache for persistent OPcache across restarts
opcache.file_cache=/tmp/opcache
; Performance: Validate cached files on every request for consistency
opcache.file_cache_consistency_checks=1
; Performance: Enable fast shutdown for improved performance
opcache.fast_shutdown=1
; Performance: Optimize string interning
opcache.interned_strings_buffer=128

[apcu]
apc.enable_cli=1
; Performance: Increase APCu memory for better local caching
apc.shm_size=256M
; Performance: Set TTL for APCu entries
apc.ttl=7200
; Performance: Enable APCu slam defense
apc.slam_defense=1